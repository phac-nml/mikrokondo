nextflow_workflow
 {
    name "Test of locidex sub-workflow"
    script "subworkflows/local/locidex.nf"
    workflow "LOCIDEX"
    tag "subworkflows"
    tag "locidex"

    test("Test of Locidex"){
        /*
            The locidex workflow take in the following channels
            contigs: val(meta), path(contigs)
            top_hit: val(meta), val(top_hit)
            Both metadata channels affect just need to contain ID
        */
        when{
            workflow {
                """
                    input[0] = Channel.of(
                        [[id: "ST120"], file("$baseDir/tests/data/fake_contigs/vibrio_cholerea/st_120.fa")],
                        [[id: "ST176"], file("$baseDir/tests/data/fake_contigs/vibrio_cholerea/st_176.fa")],
                        [[id: "ST190"], file("$baseDir/tests/data/fake_contigs/vibrio_cholerea/st_190.fa")],
                        [[id: "ST243"], file("$baseDir/tests/data/fake_contigs/vibrio_cholerea/st_243.fa")],
                        [[id: "ST25"] , file("$baseDir/tests/data/fake_contigs/vibrio_cholerea/st_25.fa")],
                        [[id: "ST284"], file("$baseDir/tests/data/fake_contigs/vibrio_cholerea/st_284.fa")],
                        [[id: "ST307"], file("$baseDir/tests/data/fake_contigs/vibrio_cholerea/st_307.fa")],
                        [[id: "ST32"] , file("$baseDir/tests/data/fake_contigs/vibrio_cholerea/st_32.fa")],
                        [[id: "ST61"] , file("$baseDir/tests/data/fake_contigs/vibrio_cholerea/st_61.fa")],
                        [[id: "ST8"]  , file("$baseDir/tests/data/fake_contigs/vibrio_cholerea/st_8.fa")],
                    )
                    input[1] = Channel.of(
                        [[id: "ST120"], 's_Vibrio cholerae'],
                        [[id: "ST176"], 's_Vibrio cholerae'],
                        [[id: "ST190"], 's_Vibrio cholerae'],
                        [[id: "ST243"], 's_Vibrio cholerae'],
                        [[id: "ST25"] , 's_Vibrio cholerae'],
                        [[id: "ST284"], 's_Vibrio cholerae'],
                        [[id: "ST307"], 's_Vibrio cholerae'],
                        [[id: "ST32"] , 's_Vibrio cholerae'],
                        [[id: "ST61"] , 's_Vibrio cholerae'],
                        [[id: "ST8"]  , 's_Vibrio cholerae'],
                    )
                """
            }
            params {
                outdir = "results"
                max_memory = "2.GB"
                max_cpus = 1
                lx_allele_database = "${projectDir}/tests/data/databases/locidex_dbs"
                lx_report_max_stop = 100
            }
        }
        then {
            assert workflow.success
        }
    }
}
